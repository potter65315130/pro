generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  role_id   Int    @id @default(autoincrement()) @map("role_id")
  role_name String @map("role_name")
  users     User[]

  @@map("roles")
}

model User {
  user_id            Int               @id @default(autoincrement()) @map("user_id")
  role_id            Int               @map("role_id")
  email              String            @unique
  password_hash      String            @map("password_hash")
  created_at         DateTime          @default(now()) @map("created_at")
  updated_at         DateTime          @default(now()) @updatedAt @map("updated_at")
  job_seeker_profile JobSeekerProfile? @relation("UserToJobSeekerProfile")
  password_resets    PasswordReset[]
  reviews            Review[]
  shop_profile       ShopProfile?      @relation("UserToShopProfile")
  role               Role              @relation(fields: [role_id], references: [role_id])

  @@map("users")
}

model PasswordReset {
  user_id    Int      @map("user_id")
  otp_code   String   @map("otp_code")
  otp_expiry DateTime @map("otp_expiry")
  created_at DateTime @default(now()) @map("created_at")
  id         Int      @id @default(autoincrement())
  is_used    Boolean  @default(false) @map("is_used")
  user       User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("password_resets")
}

model JobSeekerProfile {
  seeker_id      Int     @id @map("seeker_id")
  name           String?
  phone          String?
  address        String?
  skills         String?
  experience     String?
  available_days String? @map("available_days")
  profile_image  String? @map("profile_image")
  latitude       Float?
  longitude      Float?
  gender         String?
  age            Int?
  interested_job String? @map("interested_job")

  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt @map("updated_at")

  applications Application[]
  user         User @relation("UserToJobSeekerProfile", fields: [seeker_id], references: [user_id], onDelete: Cascade)
  matches      Match[]

  @@map("job_seeker_profiles")
}

model ShopProfile {
  shop_id     Int      @id @map("shop_id")
  shop_name   String   @map("shop_name")
  description String?
  address     String?
  phone       String?
  latitude    Float?
  longitude   Float?
  image_path  String?  @map("image_path")
  shop_image  String?  @map("shop_image")
  
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @updatedAt @map("updated_at")
  jobs        Job[]
  reviews     Review[]
  user        User     @relation("UserToShopProfile", fields: [shop_id], references: [user_id], onDelete: Cascade)

  @@map("shop_profiles")
}

model Category {
  category_id   Int    @id @default(autoincrement()) @map("category_id")
  category_name String @unique @map("category_name")
  jobs          Job[]

  @@map("categories")
}

model Job {
  job_id        Int           @id @default(autoincrement()) @map("job_id")
  shop_id       Int           @map("shop_id")
  category_id   Int           @map("category_id")
  title         String
  description   String?
  work_day      String?       @map("work_day")
  wage_per_hour Float?        @map("wage_per_hour")
  num_positions Int           @default(1) @map("num_positions")
  status        String        @default("open")
  
  // New fields
  location      String?
  latitude      Float?
  longitude     Float?
  contact_phone String?       @map("contact_phone")
  required_date DateTime?     @map("required_date")

  created_at    DateTime      @default(now()) @map("created_at")
  updated_at    DateTime      @updatedAt @map("updated_at")
  applications  Application[]
  job_schedules JobSchedule[]
  category      Category      @relation(fields: [category_id], references: [category_id])
  shop          ShopProfile   @relation(fields: [shop_id], references: [shop_id], onDelete: Cascade)
  matches       Match[]

  @@map("jobs")
}

model Review {
  review_id  Int         @id @default(autoincrement()) @map("review_id")
  user_id    Int         @map("user_id")
  shop_id    Int         @map("shop_id")
  rating     Int
  comment    String?
  created_at DateTime    @default(now()) @map("created_at")
  shop       ShopProfile @relation(fields: [shop_id], references: [shop_id], onDelete: Cascade)
  user       User        @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@unique([user_id, shop_id])
  @@map("reviews")
}

model Match {
  match_id    Int              @id @default(autoincrement()) @map("match_id")
  seeker_id   Int              @map("seeker_id")
  job_id      Int              @map("job_id")
  match_score Float?           @map("match_score")
  time_match  DateTime         @default(now()) @map("time_match")
  job         Job              @relation(fields: [job_id], references: [job_id], onDelete: Cascade)
  seeker      JobSeekerProfile @relation(fields: [seeker_id], references: [seeker_id], onDelete: Cascade)

  @@unique([seeker_id, job_id])
  @@map("matches")
}

model Application {
  application_id Int              @id @default(autoincrement()) @map("application_id")
  seeker_id      Int              @map("seeker_id")
  job_id         Int              @map("job_id")
  status         String
  applied_at     DateTime         @default(now()) @map("applied_at")
  job            Job              @relation(fields: [job_id], references: [job_id], onDelete: Cascade)
  seeker         JobSeekerProfile @relation(fields: [seeker_id], references: [seeker_id], onDelete: Cascade)
  job_schedules  JobSchedule[]

  @@unique([seeker_id, job_id])
  @@map("applications")
}

model JobSchedule {
  schedule_id    Int         @id @default(autoincrement()) @map("schedule_id")
  job_id         Int         @map("job_id")
  application_id Int         @map("application_id")
  work_day       DateTime    @map("work_day")
  start_time     DateTime    @map("start_time")
  end_time       DateTime    @map("end_time")
  application    Application @relation(fields: [application_id], references: [application_id], onDelete: Cascade)
  job            Job         @relation(fields: [job_id], references: [job_id], onDelete: Cascade)

  @@map("job_schedules")
}